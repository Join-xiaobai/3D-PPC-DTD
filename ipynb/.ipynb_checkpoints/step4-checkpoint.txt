目标是将之前在肺（Lung）和心脏（Heart）中独立发现的生物学信号进行交叉整合，构建一个包含双重特征（肺血管特异性 + 心脏核心功能）的药-靶数据集，并最终扩充为一个可用于后续建模（如“药理点云”）的平衡候选药物库。

整个流程可以分为两大块：

第一部分：构建双特征药-靶数据集

**生成肺血管特异性基因评分 **(PV Signature)：
    输入：单细胞数据集 GSE210248（包含肺动脉内皮细胞 PA EC 和平滑肌细胞 PA SMC）。
    方法：使用 Scanpy 进行差异表达分析，计算 PA 细胞 vs 其他肺细胞 的 log2FC。
    产出：pv_signature.csv，为每个基因提供一个连续的“肺血管富集”评分。

整合双特征：
    将上一步得到的 pv_log2fc 评分，与 Step3 中鉴定出的 心脏核心功能基因 (is_heart_core) 标签，合并到已有的药-靶对 (druggable_targets_compounds.csv) 中。
    关键洞察：初步筛选出的2个药-靶对（Sampatrilat & Aladorian）同时满足：
        is_heart_core = 1 （作用于心脏核心功能）
        pv_log2fc ≈ 2.78 （其靶点在肺血管中高度富集，约6.8倍）
    这表明它们能同时干预 HPH 的两个关键病理环节（肺血管重塑 + 右心功能），价值极高。

添加药物化学描述符：
    从本地 ChEMBL 数据库 (chembl_36.db) 中提取这两个化合物的理化性质（如分子量 MW、脂溶性 LogP、极性表面积 TPSA 等）。
    目的：为后续的化学空间可视化（如“药理点云”的 X 轴）提供数据基础。

第二部分：扩充候选药物库以构建“药理点云”

由于初始只有2个候选药物，不足以进行有意义的建模或可视化，因此需要大规模扩充。

生成心脏核心药物列表：
    输入：Step1 中的 19 个心脏核心功能基因。
    方法：直接查询 ChEMBL 数据库，筛选条件为：人源靶点、高活性 (pChEMBL ≥ 5.0)、有 SMILES 结构。
    产出：heart_core_drugs.csv，包含 1,502 条记录，并确认包含了 Sampatrilat 和 Aladorian。

生成肺核心药物列表：
    输入：Step1 中的 16 个肺核心功能基因。
    方法：使用与心脏完全相同的查询条件。
    产出：lung_core_drugs.csv，包含 71 条记录。

合并与质控：
    将肺和心脏的药物列表合并为一个统一的数据集 core_tissue_drugs_merged.csv (共 1,573 条记录)。
    进行严格的数据质量检查：
        确认无空 SMILES。
        确认组织标签 (tissue) 只有 "lung" 或 "heart"。
        确认无重复记录。
        统计已批准药物数量（心脏 104 个，肺 1 个）。

总结

step4.ipynb 成功完成了以下关键任务：

深度整合：首次将 肺血管特异性 (pv_log2fc) 和 心脏核心功能 (is_heart_core) 这两个维度结合起来，验证了初始候选药物（Sampatrilat, Aladorian）的独特双重价值。
数据扩充：通过系统性地查询 ChEMBL，将候选药物库从 2个 扩充到了 1,573个，形成了一个规模足够大、覆盖肺和心脏两大关键组织的平衡数据集。
为下游建模铺路：这个经过质控的、包含药物结构（SMILES）、靶点、组织特异性和活性信息的大型数据集，已经完全准备好用于下一步的分子指纹计算、相似性分析和“药理点云”可视化/建模。